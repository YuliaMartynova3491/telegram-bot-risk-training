"""
Модуль для описания уроков.
"""
from typing import List, Dict, Any
from app.database.models import get_db
from app.database.operations import create_lesson, get_lessons_by_course

# Определение уроков по темам
LESSONS = {
    1: [  # Тема: Риск нарушения непрерывности
        {
            "title": "Основные понятия",
            "content": """
# Основные понятия рисков нарушения непрерывности

## Что такое риск нарушения непрерывности?

Риск нарушения непрерывности деятельности - это риск нарушения способности кредитной организации поддерживать операционную устойчивость, включающую обеспечение непрерывности осуществления критически важных процессов и операций, в результате воздействия угроз непрерывности.

## Что такое угроза непрерывности?

Угроза непрерывности (чрезвычайная ситуация) - это обстановка на определенной территории, сложившаяся в результате аварии, опасного природного явления, катастрофы, распространения заболевания, представляющего опасность для окружающих, стихийного или иного бедствия, которые могут повлечь или повлекли за собой человеческие жертвы, ущерб здоровью людей или окружающей среде, значительные материальные потери и нарушение условий жизнедеятельности людей.

## Связь с операционным риском

Риск нарушения непрерывности является подвидом операционного риска и управляется по классической схеме (идентификация, оценка, реагирование, мониторинг), с некоторыми изменениями.
            """,
            "order": 1
        },
        {
            "title": "Типы угроз непрерывности",
            "content": """
# Типы угроз непрерывности

## Классификация угроз

Угрозы непрерывности делятся на 7 типов:
- Техногенные
- Природные
- Геополитические
- Социальные
- Биолого-социальные
- Экономические

## Оценка угроз

Угрозы имеют масштаб и вероятность реализации. Масштаб и вероятность определяются экспертным путем, в соответствии с Общим планом обеспечения непрерывности и восстановления деятельности (ОНиВД) и Регламентом ОНиВД.

## Рейтинг угрозы

В результате определения масштаба и уровня угрозы формируется рейтинг (уровень) угрозы непрерывности, который в дальнейшем используется при расчете рейтинга риска нарушения непрерывности.

## Примеры угроз непрерывности

- Отключение электроэнергии
- Пожар в здании
- Наводнение
- Эпидемия
- Кибератака
- Отказ критически важного оборудования
            """,
            "order": 2
        }
    ],
    2: [  # Тема: Оценка критичности процессов
        {
            "title": "Категории критичности процессов",
            "content": """
# Категории критичности процессов

## Процедура оценки критичности

Все процессы проходят через процедуру оценки критичности, в результате которой им присваивается категория критичности:
- Критически важный
- Основной
- Прочий

Риск нарушения непрерывности оценивается только для критически важных процессов.

## Методика оценки критичности

Оценка критичности проводится на основании методики №5908, в рамках которой владелец процесса:
1. Проверяет включение своего процесса в перечень критичных функций организации
2. Оценивает потери в случае простоя процесса в результате воздействия ЧС

## Типы оцениваемых потерь

При оценке критичности процессов рассматриваются следующие типы последствий:
- Прямые/косвенные экономические потери
- Репутационные последствия
- Юридические последствия
- Клиентские потери
            """,
            "order": 1
        },
        {
            "title": "Оценка экономических и репутационных потерь",
            "content": """
# Оценка экономических и репутационных потерь

## Экономические потери

Прямые/Косвенные экономические потери при простое процесса оцениваются по следующей шкале:
- Низкий – потенциальный ущерб не более 0,36 млн. рублей
- Средний – потенциальный ущерб от 0,36 млн. рублей до 18 млн. рублей
- Высокий – потенциальный ущерб от 18 млн. рублей до 1 800 млн. рублей
- Неприемлемый – потенциальный ущерб более 1 800 млн. рублей

## Репутационные последствия

Репутационные последствия при простое процесса оцениваются по следующей шкале:
- Низкий – простой Процесса маловероятно приводит к информации в социальных сетях
- Средний – простой Процесса может привести к единичным публикациям в социальных сетях
- Высокий – простой Процесса может привести к публикациям в СМИ, не приводящим к Информационному кризису
- Неприемлемый – простой Процесса может привести к Информационному кризису

## Временные интервалы

Оценка всех видов последствий процесса проводится по временным интервалам возможного простоя бизнес-процесса:
- До 10 мин
- До 30 мин
- До 1 часа
- До 4 часов
- До 8 часов
- До 24 часов
- До 5 дней
            """,
            "order": 2
        },
        {
            "title": "Оценка юридических последствий",
            "content": """
# Оценка юридических последствий

## Уровни юридических последствий

Юридические последствия при простое процесса оцениваются по следующей шкале:

### Средний уровень
- Предупреждение/предписание/представление об устранении причин и условий правонарушения (если не влияет на продукт/Процесс/технологию)
- Применение предупредительных мер воздействия со стороны государственных органов и/или регулятора

### Высокий уровень
- Признание недействительной (полностью или в части)/незаключенной сделки (риск продукта, влияет на продукт/Процесс/технологию в целом)
- Полная/частичная утрата обеспечения/не возникновение обеспечения в рамках сделки
- Выплата организации убытков/неустойки/компенсации вреда/суммы неосновательного обогащения/процентов за пользование чужими денежными средствами
- Полный/частичный отказ в удовлетворении требований организации
- Неисполнение условий договоров
- Предупреждение/предписание/представление об устранении причин и условий правонарушения (если влияет на продукт/Процесс/технологию)

### Неприемлемый уровень
- Отзыв лицензии
- Дисквалификация/уголовная или административная ответственность должностного лица организации
- Приостановление деятельности
- Антимонопольные санкции («оборотный» штраф, изъятие 100% дохода от продукта/Процесса, прекращение реализации продукта/Процесса)
- Штрафные санкции в процентах от минимального размера уставного капитала
- Запрет на осуществление отдельных операций
            """,
            "order": 3
        }
    ],
    3: [  # Тема: Оценка риска нарушения непрерывности
        {
            "title": "Компоненты оценки риска",
            "content": """
# Компоненты оценки риска нарушения непрерывности

## Объекты окружения процесса

Оценка риска нарушения непрерывности состоит из оценки влияния угроз непрерывности на объекты окружения (исполнения) процесса:
- Автоматизированные системы (АС), участвующие/обеспечивающие процесс
- Офис и/или офисные помещения (физические объекты)
- Количество сотрудников, участвующих в исполнении процесса
- Наличие функции аутсорсинга в процессе

## Факторы воздействия

Величина воздействия риска нарушения непрерывности напрямую зависит от:
- Величины простоя АС из-за подверженности различным угрозам
- Величины простоя, выраженной во времени необходимом для восстановления работы физических объектов
- Наличия в подразделении планов обеспечения непрерывности и восстановления деятельности
- Наличия или отсутствия аутсорсера
            """,
            "order": 1
        },
        {
            "title": "Расчет величины воздействия риска",
            "content": """
# Расчет величины воздействия риска

## Формула расчета

Величина воздействия риска нарушения непрерывности процесса рассчитывается по специальной формуле, учитывающей:
- Время на переезд в резервный комплекс или на удаленку согласно плану ОНИВД
- Фактор наличия стратегии по переезду
- Время на восстановление процесса согласно плану ОНиВД
- Время на восстановление критически важного объекта (офис)
- Время на восстановление автоматизированной системы в случае ЧС
- Необходимое и фактическое число сотрудников ИТ для восстановления процесса
- Необходимое и фактическое число сотрудников Бизнеса для восстановления процесса в режиме ЧС

## Критерии непрерывности

Воздействие риска определяется как отношение величины воздействия риска к утвержденным критериям непрерывности процесса:
- Целевое время восстановления (RTO) - период времени, установленный для возобновления работы процесса
- Максимально приемлемый период прерывания (MTPD) - период времени, по истечении которого неблагоприятные последствия, возникшие в результате прерывания деятельности организации, становятся неприемлемыми
            """,
            "order": 2
        },
        {
            "title": "Рейтинг риска и реагирование",
            "content": """
# Рейтинг риска и реагирование

## Рейтинг риска

Рейтинг риска – это характеристика риска, которая определяет приоритет мероприятий по его минимизации. Рейтинг определяется с учетом воздействия риска нарушение непрерывности на время восстановления процесса и рейтинга угрозы непрерывности.

## Этапы оценки риска

Процесс оценки риска состоит из нескольких этапов:
1. Оценка влияния окружения процесса на непрерывность процесса – выполняется владельцем, экспертами процесса, с привлечением своего департамента ИТ, архитектора
2. Оценка величины воздействия риска – выполняется на стороне управления операционных рисков
3. Расчет рейтинга риска и планирование мероприятий по минимизации

## Реагирование на риск

Реагирование на выявленные риски нарушения непрерывности в критических процессах делится на два типа:
1. Создание локальных планов обеспечения непрерывности деятельности подразделения
   - Шаги по первичному реагированию
   - Схема оповещения руководства
   - Порядок восстановления в случае ЧС
   - Шаги по возвращению в штатный режим работы
2. Реализация системных мер, направленных на снижения уровня риска - соответствуют мерам, которые формируются в рамках ежегодной самооценки операционных рисков

## Мониторинг мероприятий

Мониторинг осуществляется в соответствии с ключевыми индикаторами риска.
            """,
            "order": 3
        }
    ]
}

def init_lessons(course_id: int) -> List[Dict[str, Any]]:
    """Инициализирует уроки для указанной темы в базе данных."""
    db = get_db()
    
    # Получаем все существующие уроки для темы
    existing_lessons = get_lessons_by_course(db, course_id)
    
    # Если уроков нет, создаем их
    if not existing_lessons and course_id in LESSONS:
        for lesson_data in LESSONS[course_id]:
            create_lesson(
                db,
                course_id=course_id,
                title=lesson_data["title"],
                content=lesson_data["content"],
                order=lesson_data["order"]
            )
    
    # Получаем все уроки после инициализации
    return get_lessons_by_course(db, course_id)